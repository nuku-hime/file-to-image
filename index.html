<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi-format File Converter</title>
    <!-- 前回と同じスクリプトとスタイルの読み込み -->
</head>
<body>
    <!-- 前回と同じHTML構造 -->

    <script>
        // 前回のスクリプトの大部分は変更なし

        async function textToImage(text, fileName) {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            const lineHeight = 20;
            const maxWidth = 600;
            const padding = 20;

            ctx.font = '16px Arial';
            const lines = getLines(ctx, text, maxWidth);

            canvas.width = maxWidth + padding * 2;
            // 高さの計算を改善
            canvas.height = Math.max(lines.length * lineHeight + padding * 2, 100); // 最小高さを設定

            ctx.fillStyle = 'white';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            ctx.fillStyle = 'black';
            lines.forEach((line, index) => {
                ctx.fillText(line, padding, (index + 1) * lineHeight + padding);
            });

            ctx.fillStyle = 'blue';
            ctx.fillText(fileName, padding, padding - 5);

            const img = document.createElement('img');
            img.src = canvas.toDataURL('image/png');
            return img;
        }

        function getLines(ctx, text, maxWidth) {
            const words = text.split(' ');
            const lines = [];
            let currentLine = words[0];

            for (let i = 1; i < words.length; i++) {
                const word = words[i];
                const width = ctx.measureText(currentLine + " " + word).width;
                if (width < maxWidth) {
                    currentLine += " " + word;
                } else {
                    lines.push(currentLine);
                    currentLine = word;
                }
            }
            lines.push(currentLine);
            return lines;
        }

        // その他の関数は変更なし
    </script>
</body>
</html>
